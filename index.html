<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>화재대응조직 개인임무카드 (통합)</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class', 
            theme: {
                extend: {
                    colors: {
                        gray: {
                            750: '#2d3748',
                            850: '#1a202c',
                            950: '#0d1117',
                        }
                    },
                    fontFamily: {
                        sans: ['Pretendard', '-apple-system', 'BlinkMacSystemFont', 'system-ui', 'Roboto', 'Helvetica Neue', 'Segoe UI', 'Apple SD Gothic Neo', 'Noto Sans KR', 'Malgun Gothic', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url("https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css");
        
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        
        .tab-content { display: none; animation: fadeIn 0.3s ease-in-out; }
        .tab-content.active { display: block; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        
        .modal-enter { animation: zoomIn 0.2s ease-out forwards; }
        @keyframes zoomIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        
        .toast-enter { animation: slideUp 0.3s ease-out forwards; }
        .toast-exit { animation: slideDown 0.3s ease-in forwards; }
        @keyframes slideUp { from { transform: translateX(-50%) translateY(100%); opacity: 0; } to { transform: translateX(-50%) translateY(0); opacity: 1; } }
        @keyframes slideDown { from { transform: translateX(-50%) translateY(0); opacity: 1; } to { transform: translateX(-50%) translateY(100%); opacity: 0; } }

        /* PC Desktop Layout Utilities */
        @media (min-width: 768px) {
            .mobile-only { display: none !important; }
            .desktop-grid { display: grid; grid-template-columns: 260px 1fr; min-height: 100vh; }
            .desktop-sidebar { display: flex; flex-direction: column; }
            .content-area { height: 100vh; overflow-y: auto; }
        }
        @media (max-width: 767px) {
            .desktop-only { display: none !important; }
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-950 font-sans min-h-screen transition-colors duration-300 text-gray-800 dark:text-gray-100">

    <!-- Overall Layout Container -->
    <div class="w-full md:max-w-7xl mx-auto md:h-screen md:overflow-hidden bg-white dark:bg-gray-900 shadow-2xl relative transition-colors duration-300 desktop-grid">
        
        <!-- [PC] Sidebar Navigation -->
        <aside class="desktop-only desktop-sidebar bg-gray-50 dark:bg-gray-900 border-r border-gray-200 dark:border-gray-800 z-20">
            <div class="p-6">
                <div class="flex items-center gap-3 mb-8">
                    <div class="bg-red-600 p-2 rounded-lg shadow-sm">
                        <i data-lucide="shield-alert" class="w-6 h-6 text-white"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-gray-900 dark:text-white tracking-tight leading-none">화재대응조직</h1>
                        <span class="text-xs text-gray-500 dark:text-gray-400">Emergency Response</span>
                    </div>
                </div>

                <nav class="space-y-2">
                    <button onclick="switchTab('dashboard')" id="pc-nav-dashboard" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all font-bold bg-white dark:bg-gray-800 text-red-600 shadow-sm border border-gray-200 dark:border-gray-700">
                        <i data-lucide="layout-dashboard" class="w-5 h-5"></i>
                        <span>내 임무 대시보드</span>
                    </button>
                    <button onclick="switchTab('headquarters')" id="pc-nav-headquarters" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-800">
                        <i data-lucide="siren" class="w-5 h-5"></i>
                        <span>본부대 임무</span>
                    </button>
                    <button onclick="switchTab('district')" id="pc-nav-district" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-800">
                        <i data-lucide="users" class="w-5 h-5"></i>
                        <span>지구대 임무</span>
                    </button>
                    <button onclick="switchTab('supplies')" id="pc-nav-supplies" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-800">
                        <i data-lucide="package" class="w-5 h-5"></i>
                        <span>비상물품 위치</span>
                    </button>
                    <button onclick="switchTab('manual')" id="pc-nav-manual" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-800">
                        <i data-lucide="book-open" class="w-5 h-5"></i>
                        <span>행동 매뉴얼</span>
                    </button>
                </nav>
            </div>

            <div class="mt-auto p-6 border-t border-gray-200 dark:border-gray-800">
                <button onclick="openSettingsModal()" class="w-full flex items-center justify-between p-3 rounded-xl hover:bg-gray-200 dark:hover:bg-gray-800 transition-colors">
                    <div class="flex items-center gap-2 text-sm font-medium text-gray-600 dark:text-gray-300">
                        <i data-lucide="settings" class="w-4 h-4"></i> 설정
                    </div>
                </button>
                <div class="mt-4 text-center">
                    <p class="text-[10px] text-gray-400 dark:text-gray-600">
                        안전환경팀 (내선 1119)<br>Ver 2.0 PC/Mobile Hybrid
                    </p>
                </div>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="content-area bg-gray-50 dark:bg-gray-950 md:p-8 flex flex-col relative">
            
            <!-- [Mobile] Header -->
            <header class="mobile-only bg-white dark:bg-gray-900 px-6 py-4 border-b border-gray-100 dark:border-gray-800 flex justify-between items-center sticky top-0 z-20 transition-colors">
                <div class="flex items-center gap-2">
                    <div class="bg-red-600 p-1.5 rounded-lg shadow-sm">
                        <i data-lucide="shield-alert" class="w-5 h-5 text-white"></i>
                    </div>
                    <h1 class="text-lg font-bold text-gray-900 dark:text-white tracking-tight">화재대응조직</h1>
                </div>
                <button onclick="openSettingsModal()" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full transition-colors">
                    <i data-lucide="menu" class="w-5 h-5 text-gray-600 dark:text-gray-300"></i>
                </button>
            </header>

            <!-- Content Container -->
            <div class="flex-1 p-4 md:p-0 pb-24 md:pb-0 scrollbar-hide">
                
                <!-- TAB 1: 내 임무 (Dashboard) -->
                <div id="tab-dashboard" class="tab-content active space-y-5 md:space-y-6">
                    
                    <!-- 로고 및 타이틀 (PC only header style inside content) -->
                    <div class="flex justify-center md:justify-start mb-4 mt-2 md:mt-0 items-center gap-4">
                        <div class="bg-white/90 dark:bg-white/10 rounded-xl p-2 backdrop-blur-sm shadow-sm md:shadow-none">
                            <img src="https://raw.githubusercontent.com/hyunjiklee119-collab/whds_ert/main/whds_ert/IMAGES/WONIK.png" 
                                 alt="WONIK Logo" 
                                 class="h-14 md:h-12 object-contain"
                                 onerror="this.style.display='none'; document.getElementById('logo-fallback').classList.remove('hidden');">
                        </div>
                        <div class="desktop-only">
                            <h2 class="text-2xl font-bold text-gray-800 dark:text-white">Emergency Dashboard</h2>
                            <p class="text-sm text-gray-500">실시간 대응 현황 및 개인 임무 카드</p>
                        </div>
                        <div id="logo-fallback" class="hidden w-full h-20 bg-gray-50 dark:bg-gray-800 rounded-xl flex-col items-center justify-center border-2 border-dashed border-gray-300 dark:border-gray-700 text-gray-400 gap-1">
                            <i data-lucide="image-off" class="w-5 h-5"></i>
                        </div>
                    </div>

                    <!-- PC: Grid Layout for Dashboard -->
                    <div class="grid grid-cols-1 md:grid-cols-12 md:gap-6 gap-5">
                        
                        <!-- Col 1: 공통 절차 & 비상연락망 (MD: 5 cols) -->
                        <div class="md:col-span-5 space-y-5">
                            <!-- 공통 절차 -->
                            <div class="bg-white dark:bg-gray-800 p-5 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700 transition-colors h-full">
                                <h2 class="text-sm font-bold text-gray-800 dark:text-gray-100 mb-3 flex items-center gap-2">
                                    <i data-lucide="alert-triangle" class="w-4 h-4 text-red-500"></i>
                                    화재 시 공통 대응 절차
                                </h2>
                                <div class="grid grid-cols-4 gap-2 text-center mb-4">
                                    <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-2 flex flex-col items-center justify-center gap-1">
                                        <div class="w-8 h-8 rounded-full bg-red-100 dark:bg-red-900/50 text-red-600 dark:text-red-300 flex items-center justify-center font-bold text-sm border-2 border-white dark:border-gray-600 shadow-sm">1</div>
                                        <span class="text-[10px] font-bold text-gray-700 dark:text-gray-300">알린다</span>
                                    </div>
                                    <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-2 flex flex-col items-center justify-center gap-1">
                                        <div class="w-8 h-8 rounded-full bg-red-100 dark:bg-red-900/50 text-red-600 dark:text-red-300 flex items-center justify-center font-bold text-sm border-2 border-white dark:border-gray-600 shadow-sm">2</div>
                                        <span class="text-[10px] font-bold text-gray-700 dark:text-gray-300">누른다</span>
                                    </div>
                                    <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-2 flex flex-col items-center justify-center gap-1">
                                        <div class="w-8 h-8 rounded-full bg-red-100 dark:bg-red-900/50 text-red-600 dark:text-red-300 flex items-center justify-center font-bold text-sm border-2 border-white dark:border-gray-600 shadow-sm">3</div>
                                        <span class="text-[10px] font-bold text-gray-700 dark:text-gray-300">끄려한다</span>
                                    </div>
                                    <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-2 flex flex-col items-center justify-center gap-1">
                                        <div class="w-8 h-8 rounded-full bg-red-100 dark:bg-red-900/50 text-red-600 dark:text-red-300 flex items-center justify-center font-bold text-sm border-2 border-white dark:border-gray-600 shadow-sm">4</div>
                                        <span class="text-[10px] font-bold text-gray-700 dark:text-gray-300">대피한다</span>
                                    </div>
                                </div>
                                <div class="bg-red-50 dark:bg-red-900/20 rounded-xl p-3 border border-red-100 dark:border-red-900/30">
                                    <ul class="text-xs text-gray-700 dark:text-gray-300 space-y-1.5 leading-relaxed">
                                        <li class="flex gap-2"><span class="text-red-600 dark:text-red-400 font-bold flex-shrink-0">• (알린다)</span><span>"불이야!"라고 크게 외치고 주변 전파</span></li>
                                        <li class="flex gap-2"><span class="text-red-600 dark:text-red-400 font-bold flex-shrink-0">• (누른다)</span><span>가장 가까운 비상벨 누르고 119 신고</span></li>
                                        <li class="flex gap-2"><span class="text-red-600 dark:text-red-400 font-bold flex-shrink-0">• (끈다)</span><span>작은 불은 소화기로 진압 (실패 시 즉시 대피)</span></li>
                                        <li class="flex gap-2"><span class="text-red-600 dark:text-red-400 font-bold flex-shrink-0">• (피한다)</span><span>낮은 자세로 비상구 대피 (승강기 탑승 금지)</span></li>
                                    </ul>
                                </div>
                            </div>

                            <!-- 비상연락망 -->
                            <div class="grid grid-cols-2 gap-3">
                                <a href="tel:119" class="bg-red-500 hover:bg-red-600 dark:bg-red-600 dark:hover:bg-red-700 text-white p-3 rounded-xl flex items-center justify-center gap-2 transition-colors shadow-md group h-14">
                                    <i data-lucide="phone" class="w-5 h-5 group-hover:scale-110 transition-transform"></i><span class="font-bold">119 신고</span>
                                </a>
                                <a href="tel:02-1234-5678" class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-750 text-gray-700 dark:text-gray-200 p-3 rounded-xl flex items-center justify-center gap-2 transition-colors shadow-sm group h-14">
                                    <i data-lucide="phone" class="w-5 h-5 text-gray-500 dark:text-gray-400 group-hover:text-gray-700 dark:group-hover:text-white"></i><span class="font-bold text-sm">방재실/보안</span>
                                </a>
                                <a href="tel:010-0000-0000" class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 hover:bg-blue-50 dark:hover:bg-blue-900/20 text-gray-700 dark:text-gray-200 p-3 rounded-xl flex items-center justify-center gap-2 transition-colors shadow-sm group h-14">
                                    <i data-lucide="hard-hat" class="w-5 h-5 text-blue-500 dark:text-blue-400 group-hover:text-blue-700 dark:group-hover:text-blue-300"></i><span class="font-bold text-sm">안전관리자</span>
                                </a>
                                <a href="tel:010-1111-1111" class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 hover:bg-orange-50 dark:hover:bg-orange-900/20 text-gray-700 dark:text-gray-200 p-3 rounded-xl flex items-center justify-center gap-2 transition-colors shadow-sm group h-14">
                                    <i data-lucide="fire-extinguisher" class="w-5 h-5 text-orange-500 dark:text-orange-400 group-hover:text-orange-700 dark:group-hover:text-orange-300"></i><span class="font-bold text-sm">소방관리자</span>
                                </a>
                            </div>
                        </div>

                        <!-- Col 2: 내 임무 조회 & 집결지 (MD: 7 cols) -->
                        <div class="md:col-span-7 space-y-5">
                            <!-- 내 임무 조회 -->
                            <div class="bg-gradient-to-br from-gray-800 to-gray-900 dark:from-gray-700 dark:to-gray-800 p-5 rounded-2xl shadow-lg text-white relative overflow-hidden min-h-[340px] flex flex-col">
                                <div class="absolute top-0 right-0 p-4 opacity-10">
                                    <i data-lucide="user-check" class="w-32 h-32"></i>
                                </div>
                                <div class="relative z-10 flex-1 flex flex-col">
                                    <div class="flex items-center justify-between mb-4">
                                        <div class="flex items-center gap-2">
                                            <i data-lucide="user-check" class="w-5 h-5 text-yellow-400"></i>
                                            <h2 class="font-bold text-lg">내 임무 카드</h2>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <span id="dataStatus" class="text-[10px] text-gray-400 flex items-center gap-1">
                                                <span class="w-2 h-2 rounded-full bg-gray-500"></span>
                                                준비 중...
                                            </span>
                                        </div>
                                    </div>
                                    <div class="flex gap-2 mb-6">
                                        <input type="text" id="employeeNameInput" placeholder="이름 입력 (예: 홍길동)" class="flex-1 bg-white/10 dark:bg-black/30 border border-white/20 rounded-lg px-3 py-3 text-sm text-white placeholder-gray-400 focus:outline-none focus:border-yellow-400 transition-colors">
                                        <button onclick="searchMission()" class="bg-yellow-500 hover:bg-yellow-600 text-black font-bold px-6 py-2 rounded-lg text-sm transition-colors shadow-lg">
                                            조회
                                        </button>
                                    </div>
                                    <div id="missionResult" class="hidden bg-white/10 dark:bg-black/20 rounded-xl p-5 border border-white/10 animate-fade-in flex-1">
                                        <div class="flex flex-col md:flex-row md:justify-between md:items-start gap-4 mb-4">
                                            <div>
                                                <span class="text-xs text-gray-300 block mb-0.5">편성 조직</span>
                                                <span id="resultTeam" class="text-xl font-bold text-yellow-400"></span>
                                            </div>
                                            <div class="md:text-right">
                                                <span class="text-xs text-gray-300 block mb-0.5">상세 소속</span>
                                                <span id="resultAffiliation" class="text-sm font-medium text-gray-200"></span>
                                            </div>
                                        </div>
                                        <div class="pt-4 border-t border-white/10">
                                            <span class="text-xs text-gray-300 block mb-2 font-bold"><i data-lucide="list-checks" class="inline w-3 h-3 mr-1"></i>세부 임무</span>
                                            <ul id="resultRoleList" class="space-y-2 text-sm text-white"></ul>
                                        </div>
                                    </div>
                                    <p id="missionEmptyMsg" class="text-sm text-gray-400 text-center py-10 flex-1 flex items-center justify-center border border-dashed border-gray-600 rounded-xl">
                                        이름을 입력하여<br>비상 임무를 확인하십시오.
                                    </p>
                                </div>
                                <div class="mt-4 relative z-10">
                                    <button onclick="openRosterModal()" class="w-full flex items-center justify-center gap-2 p-2 bg-yellow-500/10 dark:bg-yellow-400/10 text-yellow-400 hover:bg-yellow-500/20 rounded-xl transition-colors text-sm font-bold border border-yellow-500/30">
                                        <i data-lucide="layout-list" class="w-4 h-4"></i>
                                        전체 조직 연명부 확인
                                    </button>
                                </div>
                            </div>

                            <!-- 집결지 -->
                            <div class="bg-white dark:bg-gray-800 p-4 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm transition-colors">
                                <h3 class="text-sm font-bold text-gray-800 dark:text-gray-200 mb-3 flex items-center gap-2">
                                    <i data-lucide="flag" class="w-4 h-4 text-green-600 dark:text-green-400"></i>
                                    주요 대피 집결지 (Assembly Point)
                                </h3>
                                <div class="grid grid-cols-2 gap-3">
                                    <div class="bg-green-50 dark:bg-green-900/20 p-3 rounded-lg text-center border border-green-100 dark:border-green-900/30">
                                        <span class="block text-xs text-green-700 dark:text-green-400 mb-1 font-bold">1차 집결지</span>
                                        <span class="block text-sm font-bold text-gray-800 dark:text-gray-200 break-keep">건물 후문 앞 공터</span>
                                    </div>
                                    <div class="bg-green-50 dark:bg-green-900/20 p-3 rounded-lg text-center border border-green-100 dark:border-green-900/30">
                                        <span class="block text-xs text-green-700 dark:text-green-400 mb-1 font-bold">2차 집결지</span>
                                        <span class="block text-sm font-bold text-gray-800 dark:text-gray-200 break-keep">진위 3산단 원익 IPS 비상 집결지</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mobile-only pt-4 pb-2 text-center">
                        <p class="text-[10px] text-gray-400 dark:text-gray-600">
                            안전은 생명입니다. | Ver 2.0<br>문의: 안전환경팀 (내선 1119)
                        </p>
                    </div>
                </div>

                <!-- TAB 2~4: PC Grid applied -->
                <div id="tab-headquarters" class="tab-content space-y-4">
                    <div class="desktop-only mb-4"><h2 class="text-xl font-bold text-gray-800 dark:text-white">본부대 임무 현황</h2></div>
                    <div id="hqList" class="space-y-2 md:grid md:grid-cols-2 md:gap-4 md:space-y-0"></div>
                </div>
                
                <div id="tab-district" class="tab-content space-y-5">
                    <div class="desktop-only mb-4"><h2 class="text-xl font-bold text-gray-800 dark:text-white">지구대(부서)별 구역</h2></div>
                    <div id="divisionList" class="space-y-3 md:grid md:grid-cols-2 md:gap-4 md:space-y-0"></div>
                </div>
                
                <div id="tab-supplies" class="tab-content space-y-4">
                    <div id="suppliesContent"></div>
                </div>
                
                <div id="tab-manual" class="tab-content space-y-4">
                    <div class="desktop-only mb-4"><h2 class="text-xl font-bold text-gray-800 dark:text-white">비상 행동 매뉴얼</h2></div>
                    <div id="manualGrid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-3 pb-6"></div>
                </div>
            </div>

            <!-- [Mobile] Bottom Navigation -->
            <nav class="mobile-only fixed bottom-0 left-0 right-0 bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-800 flex justify-between px-4 py-3 pb-6 z-30 max-w-md mx-auto shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)] transition-colors">
                <button onclick="switchTab('dashboard')" id="nav-dashboard" class="nav-btn flex flex-col items-center gap-1 transition-all text-red-600 dark:text-red-500 font-bold scale-105"><i data-lucide="shield-alert" class="w-6 h-6 fill-current"></i><span class="text-[10px]">내 임무</span></button>
                <button onclick="switchTab('headquarters')" id="nav-headquarters" class="nav-btn flex flex-col items-center gap-1 transition-all text-gray-400 dark:text-gray-500"><i data-lucide="siren" class="w-6 h-6"></i><span class="text-[10px]">본부대</span></button>
                <button onclick="switchTab('district')" id="nav-district" class="nav-btn flex flex-col items-center gap-1 transition-all text-gray-400 dark:text-gray-500"><i data-lucide="users" class="w-6 h-6"></i><span class="text-[10px]">지구대</span></button>
                <button onclick="switchTab('supplies')" id="nav-supplies" class="nav-btn flex flex-col items-center gap-1 transition-all text-gray-400 dark:text-gray-500"><i data-lucide="package" class="w-6 h-6"></i><span class="text-[10px]">비상물품</span></button>
                <button onclick="switchTab('manual')" id="nav-manual" class="nav-btn flex flex-col items-center gap-1 transition-all text-gray-400 dark:text-gray-500"><i data-lucide="book-open" class="w-6 h-6"></i><span class="text-[10px]">매뉴얼</span></button>
            </nav>
        </main>

        <!-- Settings Modal -->
        <div id="settingsModal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm transition-opacity">
            <div class="bg-white dark:bg-gray-800 rounded-2xl w-full max-w-xs overflow-hidden shadow-2xl flex flex-col relative modal-enter">
                <div class="p-5">
                    <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4 flex items-center gap-2"><i data-lucide="settings" class="w-5 h-5 text-gray-500"></i> 앱 설정</h3>
                    <div class="space-y-4">
                        <div class="flex items-center justify-between"><span class="text-sm font-medium text-gray-700 dark:text-gray-300">다크 모드</span><button onclick="toggleDarkMode()" class="relative inline-flex h-6 w-11 items-center rounded-full bg-gray-200 dark:bg-gray-600 transition-colors focus:outline-none"><span class="sr-only">Toggle Dark Mode</span><span id="darkModeToggle" class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform translate-x-1 dark:translate-x-6"></span></button></div>
                        <button onclick="loadPersonnelData(); closeSettingsModal();" class="w-full flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors"><span class="text-sm font-medium text-gray-700 dark:text-gray-300">데이터 새로고침</span><i data-lucide="refresh-cw" class="w-4 h-4 text-blue-500"></i></button>
                        <button onclick="clearLocalStorage()" class="w-full flex items-center justify-between p-3 bg-red-50 dark:bg-red-900/20 rounded-xl hover:bg-red-100 dark:hover:bg-red-900/40 transition-colors text-left"><span class="text-sm font-medium text-red-600 dark:text-red-400">내 정보 초기화</span><i data-lucide="trash-2" class="w-4 h-4 text-red-500"></i></button>
                    </div>
                    <div class="mt-6 pt-4 border-t border-gray-100 dark:border-gray-700 text-center"><button onclick="closeSettingsModal()" class="w-full py-2 bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 rounded-lg text-sm font-bold">닫기</button></div>
                </div>
            </div>
        </div>

        <!-- Roster Modal -->
        <div id="rosterModal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm transition-opacity">
            <div class="bg-white dark:bg-gray-800 rounded-2xl w-full max-w-lg md:max-w-2xl h-[90vh] overflow-hidden shadow-2xl flex flex-col relative modal-enter">
                <div class="p-6 pb-2 flex-shrink-0 relative z-10 bg-white dark:bg-gray-800">
                    <button onclick="closeRosterModal()" class="absolute top-4 right-4 text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300 z-20"><i data-lucide="x" class="w-6 h-6"></i></button>
                    <div class="mb-5 border-b border-gray-100 dark:border-gray-700 pb-3"><h3 class="text-xl font-bold text-gray-800 dark:text-white flex items-center gap-2"><i data-lucide="layout-list" class="w-5 h-5 text-red-600 dark:text-red-500"></i> 전체 조직 연명부</h3><p class="text-xs text-gray-500 dark:text-gray-400 mt-1">이름을 선택하면 내 임무로 자동 설정됩니다.</p></div>
                    <div class="relative"><input type="text" id="rosterSearchInput" onkeyup="filterRoster()" placeholder="이름, 팀, 또는 임무로 검색..." class="w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-xl focus:border-red-500 focus:ring-red-500 transition-shadow shadow-sm text-sm placeholder-gray-400"><i data-lucide="search" class="w-5 h-5 text-gray-400 absolute left-3 top-1/2 transform -translate-y-1/2"></i></div>
                </div>
                <div class="flex-1 overflow-y-auto min-h-0 p-6 pt-2 scrollbar-hide" id="rosterListContainer"><div id="rosterList" class="space-y-3 pb-4 md:grid md:grid-cols-2 md:gap-4 md:space-y-0"></div><div id="rosterNoResults" class="hidden text-center p-8 text-gray-500 dark:text-gray-400"><i data-lucide="inbox" class="w-8 h-8 mx-auto mb-2 text-gray-300 dark:text-gray-600"></i><p class="font-medium">검색 결과가 없습니다.</p></div></div>
            </div>
        </div>

        <!-- Other Modals -->
        <div id="districtModal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm transition-opacity"><div class="bg-white dark:bg-gray-800 rounded-2xl w-full max-w-sm max-h-[85vh] overflow-hidden shadow-2xl flex flex-col relative modal-enter"><div class="p-6 overflow-y-auto relative"><button onclick="closeDistrictModal()" class="absolute top-4 right-4 text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300"><i data-lucide="x" class="w-6 h-6"></i></button><div class="mb-5"><h3 id="districtModalTitle" class="text-2xl font-bold text-gray-800 dark:text-white"></h3><p class="text-sm text-gray-500 dark:text-gray-400 mt-1">관할 구역 및 초기대응체계</p></div><div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-100 dark:border-blue-900/30 rounded-xl p-4 mb-5"><h4 class="text-sm font-bold text-blue-800 dark:text-blue-200 mb-3 flex items-center gap-2"><i data-lucide="user-cog" class="w-4 h-4"></i>초기대응 조직 편성</h4><div class="space-y-3"><div class="flex gap-3 text-sm"><span class="font-bold text-gray-700 dark:text-gray-300 min-w-[70px]">팀장</span><span class="text-gray-600 dark:text-gray-400 flex-1">비상연락, 대피인원 파악 총책</span></div><div class="flex gap-3 text-sm"><span class="font-bold text-gray-700 dark:text-gray-300 min-w-[70px]">대응조직1</span><span class="text-gray-600 dark:text-gray-400 flex-1">초기 소화 활동, 화재 확산 방지</span></div><div class="flex gap-3 text-sm"><span class="font-bold text-gray-700 dark:text-gray-300 min-w-[70px]">대응조직2</span><span class="text-gray-600 dark:text-gray-400 flex-1">상황 전파 및 재실자 피난 유도</span></div></div></div><h4 class="text-sm font-bold text-gray-900 dark:text-gray-100 mb-2 flex items-center gap-2"><i data-lucide="clipboard-check" class="w-4 h-4 text-green-600 dark:text-green-400"></i>관할구역 체크리스트</h4><div id="districtModalZones" class="grid grid-cols-1 gap-2 bg-gray-50 dark:bg-gray-700 p-3 rounded-xl border border-gray-100 dark:border-gray-600"></div><div class="mt-4 text-center"><p class="text-xs text-gray-400">* 화재 발생 시 위 구역의 잔류 인원을 반드시 확인하십시오.</p></div></div></div></div>
        <div id="manualModal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm transition-opacity"><div class="bg-white dark:bg-gray-800 rounded-2xl w-full max-w-sm max-h-[85vh] overflow-hidden shadow-2xl flex flex-col relative modal-enter"><div id="modalHeader" class="h-48 flex items-center justify-center relative shrink-0 transition-colors bg-gray-100 dark:bg-gray-700 overflow-hidden"><img id="modalRealImage" src="" alt="Manual" class="hidden w-full h-full object-cover"><div id="modalFallbackIcon" class="w-full h-full flex items-center justify-center relative"><div class="absolute inset-0 border-2 border-dashed border-white/30 pointer-events-none m-2 rounded-lg"></div><div class="bg-white/30 dark:bg-black/30 p-4 rounded-full backdrop-blur-md shadow-sm z-10"><i id="modalIcon" data-lucide="flame" class="w-12 h-12 text-gray-700 dark:text-gray-200"></i></div></div><button onclick="closeModal()" class="absolute top-3 right-3 bg-black/20 hover:bg-black/30 text-white rounded-full p-1.5 transition-colors z-20"><i data-lucide="x" class="w-5 h-5"></i></button></div><div class="p-6 overflow-y-auto bg-white dark:bg-gray-800"><h3 id="modalTitle" class="text-xl font-bold text-gray-800 dark:text-white mb-1"></h3><span id="modalCategory" class="inline-block px-2 py-0.5 bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-300 text-xs rounded-md mb-4 font-medium"></span><div class="space-y-4"><h4 class="text-sm font-bold text-gray-900 dark:text-gray-100 flex items-center gap-2 border-b dark:border-gray-700 pb-2"><i data-lucide="check-square" class="w-4 h-4 text-green-600 dark:text-green-400"></i>행동 절차</h4><ol id="modalSteps" class="space-y-3"></ol></div><div class="mt-6 p-3 bg-red-50 dark:bg-red-900/20 rounded-lg flex gap-3 items-start"><i data-lucide="shield-alert" class="w-5 h-5 text-red-500 shrink-0 mt-0.5"></i><p class="text-xs text-red-600 dark:text-red-300 leading-snug">본 매뉴얼은 비상 시 참고용입니다. 실제 상황에서는 현장 지휘자의 통제에 따라 안전하게 행동하십시오.</p></div></div></div></div>
        
        <div id="toast-container" class="fixed bottom-20 left-1/2 transform -translate-x-1/2 z-50 flex flex-col items-center gap-2 w-full px-4 pointer-events-none"></div>

    </div>

    <!-- JavaScript -->
    <script>
        // Google Apps Script Web App URL (User Provided)
        const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxA4dFnRYzU9d3KXfrMnDIVdlcUFtYkIMg3cMWTiOI6JWgQ5Vtoey1frQE76062WTqZ/exec";

        let personnelDB = {}; 
        let lastLoadedData = []; 
        let timeoutHandle = null; 

        // [Sample Data for Fallback]
        const samplePersonnelData = [
            { id: 1001, name: "김방재", division: "경영지원실", team: "방재팀", group: "소방G", position: "소방대장", workLocation: "방재실", type: "본부대", task1: "화재 사실 확인 및 비상 선포 결정", task2: "현장 지휘 본부(CP) 설치 및 총괄 지휘", task3: "소방서 현장 인계 및 상황 보고" },
            { id: 5001, name: "홍길동", division: "SYSTEM사업부", team: "영업팀", group: "", position: "대응조직2", workLocation: "1층 로비", type: "지구대", task1: "1층 로비 구역 인원 피난 유도", task2: "미대피 인원 확인 (화장실 포함)", task3: "집결지 인원 파악 및 보고" },
            { id: 1004, name: "이현직", division: "직속", team: "안전환경팀", group: "안전관리G", position: "부대장", workLocation: "방재실", emergencyTeam: "지휘통제팀" }
        ];
        const headquartersMissions = [ 
            { id: 'control', teamName: '지휘통제반', icon: 'siren', commonTasks: { reception: "화재 수신반 신호 확인 및 현장 확인 지시", assembly: "자위소방대 비상 소집 발령 및 인원 파악", initial: "전관 방송 실시, 119 신고, 관계 기관 통보", followup: "소방서 현장 인계 및 피해 상황 집계 보고" }, members: [{ role: "소방대장", duties: { reception: "화재 사실 확인 및 비상 선포 여부 결정", assembly: "자위소방대 총괄 소집 명령", initial: "현장 지휘 본부 설치 및 총괄 지휘", followup: "소방서 인계 및 사고 조사 주관" } }, { role: "부대장(소방안전관리자)", duties: { reception: "대장 보좌 및 부재 시 직무 대행", assembly: "각 반별 인원 현황 파악 및 보고", initial: "주요 문적/귀중품 반출 지휘", followup: "피해 복구 계획 수립 보조" } }, { role: "상황관리자", duties: { reception: "수신반 화재 구역 확인 및 경보 전파", assembly: "안내 방송 송출 및 비상 연락망 가동", initial: "상황 일지 기록 및 유관기관 연락 유지", followup: "CCTV 기록 확보 및 상황 종료 방송" } }, { role: "비상연락관", duties: { reception: "119 신고 및 상세 위치 설명", assembly: "협력업체 및 인근 사업장 통보", initial: "소방차 진입로 안내 및 유도", followup: "부상자 이송 병원 파악 및 연락" } }] },
            { id: 'rescue', teamName: '응급구조반', icon: 'heart-pulse', commonTasks: { reception: "구급 장비(AED, 구급함) 확보 및 대기", assembly: "피난 집결지(Assembly Point)로 이동하여 인원 통제", initial: "부상자 응급처치 및 후송 대기, 미대피자 수색 지원", followup: "부상자 병원 이송 현황 파악 및 보고" }, members: [{ role: "응급구조사", duties: { reception: "구급 키트 및 AED 지참 대기", assembly: "응급처치소 설치 (안전 구역)", initial: "부상자 분류(Triage) 및 응급 처치", followup: "중증 환자 구급대 인계" } }, { role: "구조지원요원1", duties: { reception: "들것 및 구조 장비 확보", assembly: "피난 약자 담당 구역 이동", initial: "부상자 및 피난 약자 이송", followup: "구조 활동 종료 보고" } }, { role: "구조지원요원2", duties: { reception: "미대피자 발생 우려 구역 확인", assembly: "각 층별 인명 검색 실시", initial: "고립 인원 파악 및 구조 유도", followup: "최종 잔류 인원 재확인" } }] },
            { id: 'fire', teamName: '소화반', icon: 'flame', commonTasks: { reception: "소화기 및 보호구 착용 후 화재 현장 이동", assembly: "화재 현장 진입로 확보 및 통제", initial: "소화기 및 옥내소화전 활용 초기 소화 실시", followup: "잔불 정리 및 소방대 진압 활동 보조" }, members: [{ role: "소화반장", duties: { reception: "발화 지점 및 화재 종류 파악", assembly: "소화반원 방화복 착용 지시", initial: "소화 전술 결정 및 진입 지휘", followup: "잔불 정리 확인 및 현장 보존" } }, { role: "소화요원1", duties: { reception: "소화기 및 옥내소화전 위치 확인", assembly: "관창(노즐) 확보 및 화점 접근", initial: "옥내소화전 방수 및 화재 진압", followup: "사용 소화 설비 원상 복구" } }, { role: "소화요원2", duties: { reception: "소화 호스 적재함 개방", assembly: "호스 전개 및 꼬임 방지", initial: "소화전 밸브 개방 및 호스 보조", followup: "호스 건조 및 정리" } }] },
            { id: 'facility', teamName: '설비안전반', icon: 'wrench', commonTasks: { reception: "주요 설비(가스, 전기) 차단 상태 확인", assembly: "소방 시설(펌프, 물탱크) 정상 작동 확인", initial: "엘리베이터 정지 및 비상 전원 확보, 방화셔터 작동 확인", followup: "설비 복구 및 2차 피해 방지 조치" }, members: [{ role: "설비안전반장", duties: { reception: "방재 센터 설비 모니터링", assembly: "주요 설비(가스/전기) 차단 지시", initial: "스프링클러 등 소화 설비 작동 확인", followup: "설비 피해 현황 파악 및 복구 지휘" } }, { role: "전기안전관리자", duties: { reception: "화재 구역 전력 공급 현황 확인", assembly: "비상 발전기 가동 상태 점검", initial: "발화 구역 전원 차단 (비상등 제외)", followup: "전기 설비 안전 진단 및 재송전" } }, { role: "설비관리자", duties: { reception: "소화 수조 수위 확인", assembly: "공조기 정지 및 제연 설비 가동", initial: "소화 펌프 압력 정상 유지 확인", followup: "소화 용수 재충전 및 배관 점검" } }, { role: "가스안전관리자", duties: { reception: "위험물 저장소 상태 확인", assembly: "메인 가스 밸브 차단", initial: "위험물 누출 여부 확인 및 방지", followup: "가스 누출 탐지 및 안전 조치" } }] }
        ];
        const divisionData = [ 
            { divName: "SYSTEM사업부", teams: [{ name: "영업팀", zones: ["(1층) 로비", "(1층) 접견실", "(1층) 교육장", "(1층) 중회의실", "(1층) 대회의실", "(1층) 로비 화장실", "(1층) 회의실 앞 화장실"] }, { name: "CS팀", zones: ["(3층) CS팀 WS", "(3층) 제조팀 WS", "(3층) 생산기술팀 WS", "(3층) 부설연구소 WS", "(3층) 소통A 회의실", "(3층) 소통B 회의실", "(3층) 자유A 회의실", "(3층) 자유B 회의실"] }, { name: "제조팀", zones: ["(1층) GSS크린룸", "(1층) GSS PA룸", "(1층) IGS룸", "(1층) GSS 스막룸", "(1층) TC룸", "(1층) TC룸 스막"] }, { name: "생산기술팀", zones: ["(3층) 제어TEST실", "(3층) 제품기술TEST실", "(1층) 협력사 크린룸", "(1층) 협력사 스막룸", "(1층) 협력사벤더룸", "(2층) 협력사벤더룸"] }, { name: "품질G", zones: ["(1층) GPU룸", "(1층) GPU 분석실", "(1층) GPU 용접실", "(1층) GPU 준비실", "(1층) GPU 스막룸", "(1층) 품질분석실"] }] },
            { divName: "경영지원실", teams: [{ name: "재무팀", zones: ["(3층) 경영지원실 WS", "(3층) 대회의실", "(3층) 부사장실", "(3층) 중회의실", "(3층) 행복A 회의실", "(3층) 행복B 회의실", "(3층) 대표이사실", "(3층) 직속부서 WS", "(3층) 자유C 회의실", "(3층) 자유D 회의실"] }, { name: "인사팀", zones: ["(2층) 휴게실", "(2층) 피트니스", "(2층) 탈의실", "(4층) 식당", "(4층) 카페", "(4층) 직원휴게실"] }, { name: "정보전략팀", zones: ["(3층) 전산실", "(3층) 서버실", "(3층) 전산 OA창고"] }] },
            { divName: "직속", teams: [{ name: "구매팀", zones: ["(3층) 구매창고", "(1층) 자재창고", "(1층) 소모품창고", "(1층) 출하장"] }, { name: "연구소", zones: ["(지하) 연구소", "(지하) ENC창고", "(지하) 미화휴게실", "(지하) 일반창고"] }] }
        ];
        const safetyManualData = [ 
            { id: 'extinguisher', title: '1. 소화기 사용요령', category: '초기소화', icon: 'flame', iconColor: 'text-red-500', imageColor: 'bg-red-100 dark:bg-red-900/50', image: '', steps: ["소화기를 불이 난 곳으로 옮깁니다.", "손잡이 부분의 안전핀을 힘껏 뽑습니다.", "바람을 등지고 호스를 불쪽으로 향하게 잡습니다.", "손잡이를 힘껏 움켜쥐고 빗자루 쓸듯이 골고루 분사합니다."] },
            { id: 'hydrant', title: '2. 옥내소화전 사용요령', category: '초기소화', icon: 'flame', iconColor: 'text-red-500', imageColor: 'bg-red-100 dark:bg-red-900/50', image: '', steps: ["화재 발생 알림 및 소화전 함을 개방합니다.", "호스를 꺼내어 화재 지점까지 전개합니다. (호스 꼬임 주의)", "소화전 함 내부의 개폐 밸브를 왼쪽(반시계)으로 돌려 개방합니다.", "노즐(관창)을 잡고 왼쪽으로 돌려 물을 분사하여 진압합니다. (2인 1조 권장)"] },
            { id: 'manual_sys', title: '3. 소화설비 수동조작', category: '설비', icon: 'wrench', iconColor: 'text-gray-600 dark:text-gray-400', imageColor: 'bg-gray-100 dark:bg-gray-700', image: '', steps: ["[스프링클러] 화재 구역의 슈퍼비조리 판넬(SVP)로 이동하여 '수동 기동' 버튼을 누릅니다.", "[가스계소화] 방호구역 출입구 인근 수동조작함 커버를 열고 기동 버튼을 누릅니다.", "수동 조작 후 즉시 방재실에 사실을 통보합니다.", "가스계 설비의 경우 방출 표시등이 점등되면 절대 진입하지 않습니다."] },
            { id: 'ev_blanket', title: '4. 전기차 질식소화덮개', category: '특수소화', icon: 'shield-alert', iconColor: 'text-orange-500', imageColor: 'bg-orange-100 dark:bg-orange-900/50', image: '', steps: ["반드시 2인 이상이 함께 작업을 실시합니다 (고온 주의).", "소화덮개를 차량의 앞/뒤 중앙에 배치하고 펼칩니다.", "동시에 소화포를 들어 차량을 완전히 덮습니다.", "바닥 부분에 틈이 없도록 밀착시키고 화재가 진압될 때까지(약 20분 이상) 대기합니다."] },
            { id: 'scba', title: '5. 공기호흡기 착용요령', category: '보호구', icon: 'shield-alert', iconColor: 'text-blue-500', imageColor: 'bg-blue-100 dark:bg-blue-900/50', image: '', steps: ["등지게를 메고 어깨끈과 허리벨트를 몸에 맞게 조절합니다.", "면체(마스크)를 착용하고 머리끈을 조여 밀착시킵니다.", "손바닥으로 흡기구를 막고 숨을 들여마셔 기밀 상태를 점검합니다 (숨이 막혀야 정상).", "공급 밸브를 면체에 연결하고 호흡을 시작합니다."] },
            { id: 'broadcast', title: '6. 비상방송장비 사용법', category: '전파', icon: 'mic', iconColor: 'text-purple-600 dark:text-purple-400', imageColor: 'bg-purple-100 dark:bg-purple-900/50', image: '', steps: ["방재실 또는 방송실의 앰프 전원이 켜져 있는지 확인합니다.", "방송하고자 하는 구역의 버튼(또는 '전체')을 누릅니다.", "마이크의 통화 버튼을 누른 상태에서 침착하고 명확하게 방송합니다.", "방송 종료 후 반드시 버튼을 해제하여 원상 복구합니다."] },
            { id: 'cpr', title: '7. 심폐소생술(CPR) / AED', category: '응급처치', icon: 'heart-pulse', iconColor: 'text-red-600 dark:text-red-400', imageColor: 'bg-pink-100 dark:bg-pink-900/50', image: '', steps: ["[의식확인] 어깨를 두드리며 의식을 확인하고 호흡을 체크합니다.", "[신고] 주변 사람에게 119 신고 및 AED(자동심장충격기) 요청을 합니다.", "[압박] 깍지 낀 손으로 가슴 중앙을 강하고 빠르게 압박합니다. (분당 100-120회, 5cm 깊이)", "[AED] 전원을 켜고 패드를 부착한 뒤, 음성 지시에 따라 제세동 버튼을 누릅니다."] },
            { id: 'first_aid', title: '8. 부목 및 지혈법', category: '응급처치', icon: 'activity', iconColor: 'text-green-600 dark:text-green-400', imageColor: 'bg-green-100 dark:bg-green-900/50', image: '', steps: ["[지혈] 출혈 부위를 직접 압박하거나, 깨끗한 천을 대고 붕대를 감습니다.", "[지혈] 출혈이 심할 경우 심장보다 높게 유지합니다.", "[부목] 골절 부위 위/아래 관절까지 포함하여 단단한 물체(판자 등)를 댑니다.", "[부목] 끈으로 고정하되 혈액순환이 차단되지 않도록 주의합니다."] },
            { id: 'chute', title: '9. 구조대 사용방법', category: '피난', icon: 'users', iconColor: 'text-yellow-600 dark:text-yellow-400', imageColor: 'bg-yellow-100 dark:bg-yellow-900/50', image: '', steps: ["창문을 열고 구조대 지지대를 외부로 향하게 단단히 고정합니다.", "구조대 포(자루)를 창 밖으로 천천히 던집니다.", "하부 지상에 장애물이 없는지 반드시 확인합니다.", "다리부터 구조대 속으로 들어가, 팔을 벌려 마찰을 이용해 속도를 조절하며 내려갑니다."] },
            { id: 'descender', title: '10. 완강기 사용방법', category: '피난', icon: 'users', iconColor: 'text-yellow-600 dark:text-yellow-400', imageColor: 'bg-yellow-100 dark:bg-yellow-900/50', image: '', steps: ["완강기 후크를 지지대 고리에 걸고 나사를 끝까지 조여 고정합니다.", "줄이 감긴 릴(Reel)을 창 밖으로 던집니다.", "가슴벨트를 겨드랑이 밑에 걸고 몸에 맞게 꽉 조입니다.", "벽을 바라보고 손으로 벽을 짚으며 천천히 하강합니다. (만세 자세 금지)"] }
        ];

        document.addEventListener('DOMContentLoaded', () => {
            initTheme(); 
            renderHeadquarters();
            renderDistrict();
            renderSupplies(); 
            renderManualGrid();
            lucide.createIcons();
            
            const savedName = localStorage.getItem('lastUserName');
            if (savedName) {
                document.getElementById('employeeNameInput').value = savedName;
                window.autoSearchName = savedName; 
            }
            loadPersonnelData();
        });

        // Data Loading Logic (Updated for GitHub Pages)
        function startLoading() {
            const statusEl = document.getElementById('dataStatus');
            statusEl.innerHTML = `<i data-lucide="loader-2" class="w-3 h-3 animate-spin text-yellow-500"></i><span class="text-yellow-500">동기화 중...</span>`;
            lucide.createIcons();
        }

        function endLoading(success, errorMessage) {
            if(timeoutHandle) clearTimeout(timeoutHandle);
            const statusEl = document.getElementById('dataStatus');
            if (success) {
                statusEl.innerHTML = `<span class="w-2 h-2 rounded-full bg-green-500"></span><span class="text-green-500 font-bold">연동 완료</span>`;
                setTimeout(() => { statusEl.innerHTML = `<span class="w-2 h-2 rounded-full bg-green-500"></span><span class="text-gray-400">최신 데이터</span>`; }, 3000);
            } else {
                statusEl.innerHTML = `<i data-lucide="alert-circle" class="w-3 h-3 text-red-500"></i><span class="text-red-500">통신 오류</span>`;
                if(errorMessage) showToast(errorMessage);
            }
            lucide.createIcons();
        }

        function loadPersonnelData() {
            startLoading();

            // Timeout check (15 seconds)
            timeoutHandle = setTimeout(() => {
                endLoading(false, "응답 시간 초과 (서버 상태 확인 필요)");
                // Fallback to sample data on timeout
                processLoadedData({ personnel: samplePersonnelData });
            }, 15000);

            // Fetch API for GitHub Pages integration
            fetch(APPS_SCRIPT_URL)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    // Success
                    if (!data || !data.personnel || data.personnel.length === 0) {
                        endLoading(false, "시트 연결됨 (데이터 없음)");
                        processLoadedData({ personnel: [] });
                    } else {
                        processLoadedData(data);
                        endLoading(true);
                    }
                })
                .catch(error => {
                    // Failure
                    console.error('Fetch error:', error);
                    endLoading(false, "데이터 로드 실패: " + error.message);
                    // Fallback to sample data for demo purposes
                    processLoadedData({ personnel: samplePersonnelData });
                });
        }

        function processLoadedData(data) {
            lastLoadedData = data.personnel || [];
            personnelDB = {};
            const teamMapping = { "방재팀": "지휘통제반", "전산팀": "지휘통제반", "안전환경팀": "지휘통제반", "지휘통제팀": "지휘통제반", "설비팀": "설비안전반", "설비안전팀": "설비안전반", "인사팀": "응급구조반", "구매팀": "응급구조반", "제조팀": "소화반" };

            lastLoadedData.forEach(p => {
                if (!p.name || p.name.trim() === '') return;
                let isDistrict = true;
                let emergencyTeamName = p.emergencyTeam || p.team || p.division || '미정';
                let mappedTeamName = teamMapping[emergencyTeamName] || emergencyTeamName;

                if (p.type && p.type.trim() !== "") { isDistrict = p.type.includes("지구대"); } 
                else { if (headquartersMissions.find(h => h.teamName === mappedTeamName)) { isDistrict = false; emergencyTeamName = mappedTeamName; } }

                let assignedRoles = [];
                if (p.task1 || p.task2 || p.task3) {
                    if (p.task1) assignedRoles.push(p.task1);
                    if (p.task2) assignedRoles.push(p.task2);
                    if (p.task3) assignedRoles.push(p.task3);
                } else {
                    if (!isDistrict) {
                        const hqTeam = headquartersMissions.find(h => h.teamName === mappedTeamName);
                        if (hqTeam) {
                            const memberRole = hqTeam.members.find(m => m.role === p.position);
                            if (memberRole) { assignedRoles = [`[접수] ${memberRole.duties.reception}`, `[초기] ${memberRole.duties.initial}`]; } 
                            else { assignedRoles = [`[공통] ${hqTeam.commonTasks.initial}`]; }
                        }
                    } else { assignedRoles = [`[지구대] ${p.workLocation || emergencyTeamName} 피난 유도`, `[지구대] 초기 소화 활동 지원`]; }
                }
                if (assignedRoles.length === 0) assignedRoles.push("임무 정보가 없습니다.");

                personnelDB[p.name.trim()] = {
                    team: p.team || p.division,
                    group: p.group || '', 
                    position: p.position || '팀원', 
                    division: p.division, 
                    permanentTeam: p.team,
                    emergencyTeam: p.emergencyTeam || mappedTeamName, isDistrict: isDistrict, roles: assignedRoles
                };
            });
            
            if (window.autoSearchName && personnelDB[window.autoSearchName]) { searchMission(); }
        }

        // --- Helper Functions ---
        function initTheme() {
            if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark');
                updateToggleUI(true);
            } else {
                document.documentElement.classList.remove('dark');
                updateToggleUI(false);
            }
        }
        function toggleDarkMode() {
            if (document.documentElement.classList.contains('dark')) {
                document.documentElement.classList.remove('dark');
                localStorage.theme = 'light';
                updateToggleUI(false);
            } else {
                document.documentElement.classList.add('dark');
                localStorage.theme = 'dark';
                updateToggleUI(true);
            }
        }
        function updateToggleUI(isDark) {
            const toggle = document.getElementById('darkModeToggle');
            if(toggle) {
                if (isDark) { toggle.classList.remove('translate-x-1'); toggle.classList.add('translate-x-6'); } 
                else { toggle.classList.remove('translate-x-6'); toggle.classList.add('translate-x-1'); }
            }
        }
        function openSettingsModal() { document.getElementById('settingsModal').classList.remove('hidden'); lucide.createIcons(); }
        function closeSettingsModal() { document.getElementById('settingsModal').classList.add('hidden'); }
        function clearLocalStorage() { localStorage.removeItem('lastUserName'); document.getElementById('employeeNameInput').value = ''; showToast('초기화 완료'); closeSettingsModal(); }
        
        function selectPerson(name) {
            document.getElementById('employeeNameInput').value = name;
            closeRosterModal();
            switchTab('dashboard');
            if (personnelDB[name]) { searchMission(); } 
            else { window.autoSearchName = name; showToast(name + ' 님을 검색합니다...'); }
        }
        function renderRoster(data) {
            const container = document.getElementById('rosterList');
            container.innerHTML = '';
            const processedData = data.map(person => {
                const pDbEntry = personnelDB[person.name] || {};
                return {
                    name: person.name, position: person.position || pDbEntry.position,
                    emergencyTeam: pDbEntry.emergencyTeam, division: person.division || pDbEntry.division, 
                    team: person.team || pDbEntry.permanentTeam,
                    group: person.group || pDbEntry.group, 
                    isDistrict: pDbEntry.isDistrict,
                    roles: pDbEntry.roles || ['임무 미지정']
                };
            });
            if (!processedData || processedData.length === 0) { document.getElementById('rosterNoResults').classList.remove('hidden'); return; }
            document.getElementById('rosterNoResults').classList.add('hidden');
            processedData.forEach(person => {
                const card = document.createElement('div');
                card.className = 'bg-gray-50 dark:bg-gray-700/50 rounded-xl p-4 border border-gray-100 dark:border-gray-600 shadow-sm relative overflow-hidden group hover:border-red-200 dark:hover:border-red-900 transition-colors cursor-pointer active:scale-95';
                card.onclick = () => selectPerson(person.name);
                const teamBadgeColor = person.isDistrict ? 'bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300' : 'bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300';
                const teamType = person.isDistrict ? '지구대' : '본부대';
                const rolesHtml = person.roles.map(role => `<div class="flex gap-2 items-start"><i data-lucide="check-circle-2" class="w-3.5 h-3.5 text-red-500 mt-0.5 shrink-0"></i><span class="text-xs text-gray-700 dark:text-gray-300 leading-snug">${role}</span></div>`).join('');
                
                const groupName = person.group ? person.group : '-';

                card.innerHTML = `<div class="flex justify-between items-start mb-2"><div class="flex items-center gap-2"><span class="text-base font-bold text-gray-900 dark:text-white">${person.name}</span><span class="text-xs text-gray-500 dark:text-gray-400">(${person.position})</span></div><span class="${teamBadgeColor} px-2 py-0.5 rounded text-[10px] font-bold tracking-wide">${teamType}</span></div><div class="grid grid-cols-2 gap-2 text-xs mb-3 text-gray-600 dark:text-gray-300"><div class="flex flex-col"><span class="text-[10px] text-gray-400 mb-0.5">비상 소속</span><span class="font-semibold text-gray-800 dark:text-gray-200">${person.emergencyTeam || '-'}</span></div><div class="flex flex-col"><span class="text-[10px] text-gray-400 mb-0.5">평상시 소속</span><span>${person.division} / ${person.team} / ${groupName}</span></div></div><div class="bg-white dark:bg-gray-800 rounded-lg p-2.5 border border-gray-100 dark:border-gray-700 space-y-1.5">${rolesHtml}</div>`;
                container.appendChild(card);
            });
            lucide.createIcons();
        }
        function searchMission() {
            const name = document.getElementById('employeeNameInput').value.trim();
            const resultDiv = document.getElementById('missionResult');
            const emptyMsg = document.getElementById('missionEmptyMsg');
            const resultTeam = document.getElementById('resultTeam');
            const resultAffiliation = document.getElementById('resultAffiliation');
            const resultRoleList = document.getElementById('resultRoleList');
            if (personnelDB[name]) {
                localStorage.setItem('lastUserName', name);
                const data = personnelDB[name];
                const teamType = data.isDistrict ? '지구대' : '본부대';
                const groupName = data.group ? data.group : '-';

                resultTeam.textContent = `${data.emergencyTeam} (${teamType})`;
                resultAffiliation.textContent = `${data.division} / ${data.team} / ${groupName}`;

                resultRoleList.innerHTML = '';
                if(Array.isArray(data.roles)) {
                    data.roles.forEach(role => {
                        const li = document.createElement('li');
                        li.className = 'flex items-start gap-2';
                        li.innerHTML = `<i data-lucide="check" class="w-3.5 h-3.5 text-yellow-400 mt-0.5 shrink-0"></i> <span class="leading-relaxed">${role}</span>`;
                        resultRoleList.appendChild(li);
                    });
                }
                resultDiv.classList.remove('hidden');
                emptyMsg.classList.add('hidden');
                lucide.createIcons(); 
            } else {
                showToast("등록된 정보가 없습니다.");
                resultDiv.classList.add('hidden');
                emptyMsg.classList.remove('hidden');
            }
        }
        function filterRoster() {
            const input = document.getElementById('rosterSearchInput').value.trim().toUpperCase();
            const sourceData = (lastLoadedData.length > 0) ? lastLoadedData : samplePersonnelData;
            const filteredData = sourceData.filter(person => {
                const pDbEntry = personnelDB[person.name] || {};
                const groupName = person.group || pDbEntry.group || '';
                const searchString = `${person.name} ${person.division || ''} ${person.team || ''} ${groupName} ${person.position || ''} ${pDbEntry.emergencyTeam || ''}`.toUpperCase();
                return searchString.includes(input);
            });
            renderRoster(filteredData);
        }
        function openRosterModal() {
            const dataToRender = (lastLoadedData.length > 0) ? lastLoadedData : samplePersonnelData;
            renderRoster(dataToRender);
            document.getElementById('rosterModal').classList.remove('hidden');
            document.getElementById('rosterSearchInput').value = '';
            lucide.createIcons();
        }
        function closeRosterModal() { document.getElementById('rosterModal').classList.add('hidden'); }
        function openDistrictModal(divName, teamName, dIdx, tIdx) {
            const team = divisionData[dIdx].teams[tIdx];
            document.getElementById('districtModal').classList.remove('hidden');
            document.getElementById('districtModalTitle').textContent = teamName;
            document.getElementById('districtModalZones').innerHTML = team.zones.map(zone => `<label class="flex items-start gap-2 p-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded hover:bg-blue-50 dark:hover:bg-blue-900/30 cursor-pointer transition-colors"><input type="checkbox" class="mt-0.5 rounded text-blue-600 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-500"><span class="text-xs text-gray-600 dark:text-gray-300 font-medium leading-tight">${zone}</span></label>`).join('');
            lucide.createIcons();
        }
        function closeDistrictModal() { document.getElementById('districtModal').classList.add('hidden'); }
        function openModal(idx) {
            const item = safetyManualData[idx];
            document.getElementById('manualModal').classList.remove('hidden');
            document.getElementById('modalTitle').textContent = item.title;
            document.getElementById('modalCategory').textContent = item.category;
            const realImg = document.getElementById('modalRealImage');
            const fallbackIcon = document.getElementById('modalFallbackIcon');
            if (item.image) { realImg.src = item.image; realImg.classList.remove('hidden'); fallbackIcon.classList.add('hidden'); } 
            else { realImg.classList.add('hidden'); fallbackIcon.classList.remove('hidden'); }
            document.getElementById('modalSteps').innerHTML = item.steps.map((step, i) => `<li class="flex gap-3 text-sm text-gray-700 dark:text-gray-300"><span class="flex-shrink-0 w-6 h-6 bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 rounded-full flex items-center justify-center font-bold text-xs">${i + 1}</span><span class="leading-relaxed">${step}</span></li>`).join('');
            lucide.createIcons();
        }
        function closeModal() { document.getElementById('manualModal').classList.add('hidden'); }
        function showToast(message) {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = 'bg-gray-800 text-white text-sm px-4 py-3 rounded-lg shadow-lg flex items-center gap-2 toast-enter pointer-events-auto max-w-[90%]';
            toast.innerHTML = `<i data-lucide="info" class="w-4 h-4 text-yellow-400"></i><span>${message}</span>`;
            container.appendChild(toast);
            lucide.createIcons();
            setTimeout(() => { toast.classList.remove('toast-enter'); toast.classList.add('toast-exit'); setTimeout(() => { toast.remove(); }, 300); }, 3000);
        }
        
        // Updated switchTab to handle both Mobile and PC Navigation
        function switchTab(tabId) {
            // Hide all contents
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById('tab-' + tabId).classList.add('active');
            
            // --- Mobile Nav Reset & Active ---
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('text-red-600', 'font-bold', 'scale-105', 'text-green-600', 'text-blue-600', 'dark:text-red-500', 'dark:text-green-500', 'dark:text-blue-400');
                btn.classList.add('text-gray-400');
                const icon = btn.querySelector('svg');
                if(icon) icon.classList.remove('fill-current');
            });
            
            const activeMobileBtn = document.getElementById('nav-' + tabId);
            if(activeMobileBtn) {
                activeMobileBtn.classList.remove('text-gray-400');
                if (tabId === 'manual') { activeMobileBtn.classList.add('text-green-600', 'dark:text-green-500', 'font-bold', 'scale-105'); } 
                else { if (tabId === 'supplies') { activeMobileBtn.classList.add('text-blue-600', 'dark:text-blue-400', 'font-bold', 'scale-105'); } 
                else { activeMobileBtn.classList.add('text-red-600', 'dark:text-red-500', 'font-bold', 'scale-105'); } }
                const activeIcon = activeMobileBtn.querySelector('svg');
                if(activeIcon) activeIcon.classList.add('fill-current');
            }

            // --- PC Nav Reset & Active ---
            document.querySelectorAll('[id^="pc-nav-"]').forEach(btn => {
                btn.className = 'w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-800';
            });
            const activePcBtn = document.getElementById('pc-nav-' + tabId);
            if(activePcBtn) {
                // Style for active PC tab
                activePcBtn.className = 'w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all font-bold bg-white dark:bg-gray-800 text-red-600 shadow-sm border border-gray-200 dark:border-gray-700';
            }
        }
        
        function renderSupplies() {
            const html = `<div class="bg-gradient-to-r from-blue-600 to-indigo-600 dark:from-blue-800 dark:to-indigo-800 p-6 rounded-2xl shadow-lg text-white relative overflow-hidden transition-colors"><div class="relative z-10"><h2 class="text-xl font-bold flex items-center gap-2"><i data-lucide="package" class="w-6 h-6 text-white"></i>비상 물품 위치</h2><p class="text-sm text-blue-100 mt-2 opacity-90 leading-snug">생명 구조를 위한 장비 위치입니다.<br>평상시 위치를 파악해 두세요.</p></div><i data-lucide="package-search" class="absolute -bottom-4 -right-4 w-24 h-24 text-white opacity-10 rotate-12"></i></div><div class="bg-white dark:bg-gray-800 p-4 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm transition-colors"><h3 class="text-sm font-bold text-gray-800 dark:text-gray-200 mb-3 flex items-center gap-2"><i data-lucide="package-search" class="w-4 h-4 text-blue-600 dark:text-blue-400"></i>물품별 상세 위치</h3><div class="space-y-2 text-sm"><div class="flex justify-between items-center border-b border-gray-100 dark:border-gray-700 pb-2"><span class="text-gray-600 dark:text-gray-400 flex items-center gap-1.5 shrink-0"><i data-lucide="heart-pulse" class="w-3.5 h-3.5 text-red-500"></i> AED</span><span class="font-medium text-gray-800 dark:text-gray-200 text-right break-keep">1층 로비, 1층 GATE2 측, 3층 EV홀</span></div><div class="flex justify-between items-center border-b border-gray-100 dark:border-gray-700 pb-2"><span class="text-gray-600 dark:text-gray-400 flex items-center gap-1.5 shrink-0"><i data-lucide="wind" class="w-3.5 h-3.5 text-blue-500"></i> 공기호흡기</span><span class="font-medium text-gray-800 dark:text-gray-200 text-right break-keep">1층 로비(60분 2개), 지주 입구(30분 2개)</span></div><div class="flex justify-between items-center border-b border-gray-100 dark:border-gray-700 pb-2"><span class="text-gray-600 dark:text-gray-400 flex items-center gap-1.5 shrink-0"><i data-lucide="plus-square" class="w-3.5 h-3.5 text-green-500"></i> 구조용 들것</span><span class="font-medium text-gray-800 dark:text-gray-200 text-right break-keep">1층 로비, 지하 보호구함, 1층 보건실</span></div><div class="flex justify-between items-center pt-2"><span class="text-gray-600 dark:text-gray-400 flex items-center gap-1.5 shrink-0"><i data-lucide="layers" class="w-3.5 h-3.5 text-orange-500"></i> 질식소화덮개</span><span class="font-medium text-gray-800 dark:text-gray-200 text-right break-keep">지하 주차장 입구 보관함</span></div></div></div>`;
            document.getElementById('suppliesContent').innerHTML = html;
        }
        function renderHeadquarters() { 
            const container = document.getElementById('hqList');
            container.innerHTML = headquartersMissions.map(team => `<div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl overflow-hidden shadow-sm transition-colors"><button onclick="toggleAccordion('hq-${team.id}')" class="w-full flex items-center justify-between p-4 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors"><div class="flex items-center gap-3"><div class="bg-gray-100 dark:bg-gray-700 p-2 rounded-lg"><i data-lucide="${team.icon}" class="w-5 h-5 text-gray-700 dark:text-gray-300"></i></div><span class="font-bold text-gray-800 dark:text-white">${team.teamName}</span></div><i data-lucide="chevron-down" class="w-5 h-5 text-gray-400 dark:text-gray-500 transition-transform" id="icon-hq-${team.id}"></i></button><div id="hq-${team.id}" class="hidden p-4 bg-gray-50 dark:bg-gray-750 border-t border-gray-100 dark:border-gray-700 text-sm space-y-4"><div class="space-y-3 border-b border-gray-200 dark:border-gray-600 pb-4"><h4 class="font-bold text-gray-900 dark:text-gray-200 text-xs flex items-center gap-1"><i data-lucide="layers" class="w-3 h-3"></i> 조직 공통 임무</h4><div class="grid grid-cols-[80px_1fr] gap-2 items-start"><span class="bg-blue-100 dark:bg-blue-900/50 text-blue-700 dark:text-blue-300 px-2 py-0.5 rounded text-xs font-bold text-center">상황접수</span><span class="text-gray-700 dark:text-gray-300">${team.commonTasks.reception}</span></div><div class="grid grid-cols-[80px_1fr] gap-2 items-start"><span class="bg-red-100 dark:bg-red-900/50 text-red-700 dark:text-red-300 px-2 py-0.5 rounded text-xs font-bold text-center">초기대응</span><span class="text-gray-700 dark:text-gray-300 font-medium">${team.commonTasks.initial}</span></div></div><div class="space-y-2"><h4 class="font-bold text-gray-900 dark:text-gray-200 text-xs flex items-center gap-1"><i data-lucide="user" class="w-3 h-3"></i> 구성원별 세부 임무</h4>${team.members.map((member, mIdx) => `<div class="border border-gray-100 dark:border-gray-600 rounded-lg overflow-hidden"><button onclick="toggleAccordion('hq-mem-${team.id}-${mIdx}')" class="w-full flex items-center justify-between p-3 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors text-left"><span class="text-sm font-bold text-gray-700 dark:text-gray-200">· ${member.role}</span><i data-lucide="chevron-down" class="w-3 h-3 text-gray-500 dark:text-gray-400 transition-transform" id="icon-hq-mem-${team.id}-${mIdx}"></i></button><div id="hq-mem-${team.id}-${mIdx}" class="hidden p-3 bg-white dark:bg-gray-800 text-xs text-gray-600 dark:text-gray-300 space-y-2"><div class="flex gap-2"><span class="min-w-[40px] font-bold text-blue-600 dark:text-blue-400">접수</span><span>${member.duties.reception}</span></div><div class="flex gap-2"><span class="min-w-[40px] font-bold text-red-600 dark:text-red-400">초기</span><span>${member.duties.initial}</span></div></div></div>`).join('')}</div></div></div>`).join('');
        }
        function renderDistrict() { 
            const container = document.getElementById('divisionList');
            container.innerHTML = divisionData.map((div, dIdx) => `<div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-sm overflow-hidden mb-2 transition-colors"><button onclick="toggleAccordion('div-${dIdx}')" class="w-full flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-750 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors border-b border-gray-100 dark:border-gray-700"><span class="font-bold text-gray-800 dark:text-gray-200 text-base">${div.divName}</span><i data-lucide="chevron-down" class="w-4 h-4 text-gray-500 dark:text-gray-400 transition-transform" id="icon-div-${dIdx}"></i></button><div id="div-${dIdx}" class="hidden p-2 bg-white dark:bg-gray-800 space-y-2">${div.teams.map((team, tIdx) => `<button onclick="openDistrictModal('${div.divName}', '${team.name}', ${dIdx}, ${tIdx})" class="w-full flex items-center justify-between p-3 border border-gray-100 dark:border-gray-700 rounded-lg hover:border-blue-200 dark:hover:border-blue-700 hover:bg-blue-50 dark:hover:bg-blue-900/30 transition-all text-left group"><div class="flex items-center gap-2"><i data-lucide="map-pin" class="w-4 h-4 text-gray-400 dark:text-gray-500 group-hover:text-blue-500 dark:group-hover:text-blue-400"></i><span class="font-medium text-gray-700 dark:text-gray-300 group-hover:text-blue-700 dark:group-hover:text-blue-300">${team.name}</span></div><i data-lucide="chevron-right" class="w-4 h-4 text-gray-300 dark:text-gray-600 group-hover:text-blue-400 dark:group-hover:text-blue-400"></i></button>`).join('')}</div></div>`).join('');
        }
        function renderManualGrid() { 
            const container = document.getElementById('manualGrid');
            container.innerHTML = safetyManualData.map((manual, idx) => `<button onclick="openModal(${idx})" class="flex flex-col items-center justify-center p-4 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl shadow-sm hover:shadow-md hover:border-emerald-200 dark:hover:border-emerald-700 active:scale-95 transition-all text-center gap-3 aspect-square"><div class="p-3 rounded-full ${manual.imageColor}"><i data-lucide="${manual.icon}" class="w-6 h-6 ${manual.iconColor}"></i></div><span class="text-sm font-bold text-gray-800 dark:text-gray-200 break-keep leading-tight">${manual.title.substring(3)}</span></button>`).join('');
        }
        function toggleAccordion(id) {
            const content = document.getElementById(id);
            const icon = document.getElementById('icon-' + id);
            if (content.classList.contains('hidden')) { content.classList.remove('hidden'); if(icon) icon.style.transform = 'rotate(180deg)'; } 
            else { content.classList.add('hidden'); if(icon) icon.style.transform = 'rotate(0deg)'; }
        }
    </script>
</body>
</html>
